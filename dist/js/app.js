function YelpSearch(){var e=this;e.getDetails=ko.computed(function(){var e="http://api.yelp.com/v2/search",t=Math.floor(1e12*Math.random()).toString(),s={oauth_consumer_key:auth.YELP_KEY,oauth_token:auth.YELP_TOKEN,oauth_nonce:t,oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:selection(),location:"San Diego, CA",limit:"1"},o=oauthSignature.generate("GET",e,s,auth.YELP_KEY_SECRET,auth.YELP_TOKEN_SECRET);s.oauth_signature=o;var a={url:e,data:s,cache:!0,dataType:"jsonp",success:function(e){searchResults.detailsResults(e.businesses[0]),searchResults.pubName(e.businesses[0].name),searchResults.dph(e.businesses[0].display_phone),searchResults.ph(e.businesses[0].phone),searchResults.address(e.businesses[0].location.display_address),searchResults.url(e.businesses[0].url),searchResults.stars(e.businesses[0].rating_img_url_small),searchResults.snippet(e.businesses[0].snippet_text),console.log("yelpSearch-5: pubname",searchResults.pubName()),null!=searchResults.pubName()&&selectedPub().selected()},error:function(e,t,s){alert("Geocode was not successful for the following reason: "+t),console.log("yelpSearch-error")}};null!=selection()&&""!=selection()&&$.ajax(a)})}function updateInfoWindowText(e,t){infoWindowText(e!=searchResults.pubName()?'<div id="container-pub"><h2 class= "info-location-name">'+e+"</h2><p>loading info ...</p></div>":'<div id="container-pub"><h2 class= "info-location-name">'+searchResults.pubName()+'&nbsp &nbsp <a href="tel:'+searchResults.ph()+'">'+searchResults.dph()+"</a></h2><p>"+searchResults.address()+'<br></p><img src="'+searchResults.stars()+'" height="17" width ="84"><p>'+searchResults.snippet()+'<a href="'+searchResults.url()+'"> Read more</a></p></div>')}function brewpub(e){var t=this;t.name=e.name,t.lat=e.location.coordinate.latitude,t.lng=e.location.coordinate.longitude,t.image={url:"img/beerpub-icon.png"},t.imageSelected={url:"img/beerpub-icon-selected.png"},t.contentString=infoWindowText(),t.infoWindow=new google.maps.InfoWindow({content:t.name}),t.marker=ko.computed(function(){return new google.maps.Marker({icon:t.image,position:new google.maps.LatLng(t.lat,t.lng),title:t.name})}),t.toggleBounce=function(){null!==t.marker().getAnimation()?(t.marker().setIcon(t.image),t.marker().setAnimation(null)):(t.marker().setIcon(t.imageSelected),t.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.marker().setAnimation(null),t.marker().setIcon(t.image)},2e3))},t.toggleSelected=function(e){$("ul").find(".pure-menu-item").removeClass("pure-menu-selected"),$("ul").find(".pure-menu-item").filter(":contains("+e+")").addClass("pure-menu-selected")},t.selected=function(){t.toggleBounce(),t.toggleSelected(t.name),updateInfoWindowText(t.name,"selected"),t.infoWindow.setContent(infoWindowText()),t.infoWindow.open(map,t.marker())},t.notselected=function(){$(".pure-menu-item").removeClass("pure-menu-selected"),t.infoWindow.close()}}function ListViewModel(){var e=this;e.testb=function(){console.log("testbutton")},e.layout=$("#layout").get(0),e.menu=$("#menu").get(0),e.menuLink=$("#menuLink1").get(0),e.sidebarToggle=function(e,t){for(var s=e.className.split(/\s+/),o=s.length,a=0;o>a;a++)if(s[a]===t){s.splice(a,1);break}o===s.length&&s.push(t),e.className=s.join(" ")},e.toggle=function(t){var s="active";e.sidebarToggle(e.layout,s),e.sidebarToggle(e.menu,s),e.sidebarToggle(e.menuLink,s)},e.search=ko.computed(function(){if(e.tempBrewpub=allBrewpubs.slice(0),query().length<1){for(var t=0;t<allBrewpubs().length;t++)allBrewpubs()[t].notselected(),allBrewpubs()[t].marker().setMap(map);return e.tempBrewpub}e.tempBrewpub=[];for(var t=0;t<allBrewpubs().length;t++){allBrewpubs()[t].notselected(),allBrewpubs()[t].marker().setMap(null);var s=allBrewpubs()[t].name.toLowerCase();query().length>0&&s.search(query().toLowerCase())>-1&&(allBrewpubs()[t].marker().setMap(map),e.tempBrewpub.push(allBrewpubs()[t]))}return console.log("search matches",e.tempBrewpub),e.tempBrewpub}),e.clickedListing=function(e){selection(""),selection(e.name);for(var t=0;t<allBrewpubs().length;t++)allBrewpubs()[t].notselected(),selection()===allBrewpubs()[t].name&&(allBrewpubs()[t].toggleBounce(),allBrewpubs()[t].marker().setMap(map))}}function GoogleMapViewModel(){function e(){function e(e){for(var t=0;t<initialBrewpubs.length;t++)allBrewpubs()[t].notselected(),console.log("debug:brewDetail:",e,allBrewpubs()[t].name),e===allBrewpubs()[t].name&&allBrewpubs()[t].selected()}function t(){for(var e=0;e<initialBrewpubs.length;e++)allBrewpubs()[e].notselected()}for(var s=0;s<initialBrewpubs.length;s++)allBrewpubs()[s].marker().setMap(null);for(var s=0;s<initialBrewpubs.length;s++)allBrewpubs()[s].marker().setMap(map),google.maps.event.addListener(allBrewpubs()[s].marker(),"click",function(){e(this.title),selection(this.title)}),google.maps.event.addListener(allBrewpubs()[s].infoWindow,"closeclick",function(){t()})}var t=this,s=initialLocation;t.latlng=new google.maps.LatLng(s.location.lat,s.location.lng),t.mapOptions={center:{lat:s.location.lat,lng:s.location.lng},zoom:12},map=new google.maps.Map(document.getElementById("map-canvas")),map.setCenter(t.mapOptions.center),map.setZoom(t.mapOptions.zoom),map.set("styles",[{stylers:[{saturation:-100}]},{featureType:"water",stylers:[{saturation:-100},{lightness:-46}]}]);for(var o=0;o<initialBrewpubs.length;o++)allBrewpubs.push(new brewpub(initialBrewpubs[o])),allBrewpubs()[o].marker().setMap(null);infoWindowText(""),e()}function masterVM(){this.mapViewModel=new GoogleMapViewModel,this.listViewModel=new ListViewModel,this.yelpSearch=new YelpSearch}function googleSuccess(){"object"==typeof google&&"object"==typeof google.maps?ko.applyBindings(new masterVM):console.log("google maps didn't load")}function googleError(){console.log("google maps didn't load")}var map,geocoder,searchArea=ko.observable("San Diego City, CA"),allBrewpubs=ko.observableArray([]),query=ko.observable(""),selection=ko.observable(""),selectionIndex=ko.computed(function(){for(var e=0;e<allBrewpubs().length;e++)if(selection()===allBrewpubs()[e].name)return e}),selectedPub=ko.computed(function(){return allBrewpubs()[selectionIndex()]}),infoWindowText=ko.observable(""),searchResults={detailsResults:ko.observable(),pubName:ko.observable(),dph:ko.observable(),ph:ko.observable(),address:ko.observable(),city:ko.observable(),state:ko.observable(),zip:ko.observable(),url:ko.observable(),stars:ko.observable(),snippet:ko.observable()};